(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0bdaddca"],{"1f27":function(e,t,a){"use strict";var n=a("9efd"),i="/api/admin/menus",o={listAll:function(){return Object(n["a"])({url:i,method:"get"})},listTree:function(){return Object(n["a"])({url:"".concat(i,"/tree_view"),method:"get"})},create:function(e){return Object(n["a"])({url:i,data:e,method:"post"})},delete:function(e){return Object(n["a"])({url:"".concat(i,"/").concat(e),method:"delete"})},get:function(e){return Object(n["a"])({url:"".concat(i,"/").concat(e),method:"get"})},update:function(e,t){return Object(n["a"])({url:"".concat(i,"/").concat(e),data:t,method:"put"})},listTeams:function(){return Object(n["a"])({url:"".concat(i,"/teams"),method:"get"})}};t["a"]=o},3993:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-drawer",{attrs:{title:e.title,width:e.isMobile()?"100%":e.drawerWidth,closable:"",visible:e.visible,destroyOnClose:""},on:{close:e.onClose}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-input-search",{attrs:{placeholder:"搜索附件",enterButton:""},on:{search:function(t){return e.handleQuery()}},model:{value:e.queryParam.keyword,callback:function(t){e.$set(e.queryParam,"keyword",t)},expression:"queryParam.keyword"}})],1),a("a-divider"),a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-skeleton",{attrs:{active:"",loading:e.skeletonLoading,paragraph:{rows:18}}},[a("a-col",{attrs:{span:24}},[0==e.attachments.length?a("a-empty"):e._l(e.attachments,(function(t,n){return a("div",{key:n,staticClass:"attach-item",on:{click:function(a){return e.handleSelectAttachment(t)}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!e.handleJudgeMediaType(t),expression:"!handleJudgeMediaType(item)"}]},[e._v("当前格式不支持预览")]),a("img",{directives:[{name:"show",rawName:"v-show",value:e.handleJudgeMediaType(t),expression:"handleJudgeMediaType(item)"}],attrs:{src:t.thumbPath,loading:"lazy"}})])}))],2)],1)],1),a("a-divider"),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{attrs:{current:e.pagination.page,total:e.pagination.total,defaultPageSize:e.pagination.size},on:{change:e.handlePaginationChange}})],1),a("a-divider",{staticClass:"divider-transparent"}),a("div",{staticClass:"bottom-control"},[e.isChooseAvatar?a("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"dashed"},on:{click:e.handleSelectGravatar}},[e._v("使用 Gravatar")]):e._e(),a("a-button",{attrs:{type:"primary"},on:{click:e.handleShowUploadModal}},[e._v("上传附件")])],1)],1),a("a-modal",{attrs:{title:"上传附件",footer:null,afterClose:e.onUploadClose,destroyOnClose:""},model:{value:e.uploadVisible,callback:function(t){e.uploadVisible=t},expression:"uploadVisible"}},[a("FilePondUpload",{ref:"upload",attrs:{uploadHandler:e.uploadHandler}})],1)],1)},i=[],o=(a("28a5"),a("55dd"),a("c5f6"),a("ac0d")),r=a("a796"),l={name:"AttachmentSelectDrawer",mixins:[o["a"],o["b"]],model:{prop:"visible",event:"close"},props:{visible:{type:Boolean,required:!1,default:!1},drawerWidth:{type:Number,required:!1,default:480},title:{type:String,required:!1,default:"选择附件"},isChooseAvatar:{type:Boolean,required:!1,default:!1}},data:function(){return{uploadVisible:!1,skeletonLoading:!0,pagination:{page:1,size:12,sort:null,total:1},queryParam:{page:0,size:12,sort:null,keyword:null},attachments:[],uploadHandler:r["a"].upload}},watch:{visible:function(e,t){e&&(this.loadSkeleton(),this.loadAttachments())}},methods:{loadSkeleton:function(){var e=this;this.skeletonLoading=!0,setTimeout((function(){e.skeletonLoading=!1}),500)},handleShowUploadModal:function(){this.uploadVisible=!0},loadAttachments:function(){var e=this;this.queryParam.page=this.pagination.page-1,this.queryParam.size=this.pagination.size,this.queryParam.sort=this.pagination.sort,r["a"].query(this.queryParam).then((function(t){e.attachments=t.data.data.content,e.pagination.total=t.data.data.total}))},handleQuery:function(){this.handlePaginationChange(1,this.pagination.size)},handleSelectAttachment:function(e){this.$emit("listenToSelect",e)},handleSelectGravatar:function(){this.$emit("listenToSelectGravatar")},handlePaginationChange:function(e,t){this.pagination.page=e,this.pagination.size=t,this.loadAttachments()},onUploadClose:function(){this.$refs.upload.handleClearFileList(),this.loadSkeleton(),this.handlePaginationChange(1,this.pagination.size)},handleJudgeMediaType:function(e){var t=e.mediaType;if(t){var a=t.split("/")[0];return"image"===a}return!1},onClose:function(){this.$emit("close",!1)}}},c=l,s=a("2877"),d=Object(s["a"])(c,n,i,!1,null,null,null);t["a"]=d.exports},"7e9e":function(e,t,a){"use strict";a("7f7f"),a("ac6a");var n=a("9efd"),i="/api/admin/specials",o={};function r(e,t){t.forEach((function(t){e.key===t.parentId&&(e.children||(e.children=[]),e.children.push({key:t.id,title:t.name,isLeaf:!1}))})),e.children?e.children.forEach((function(e){return r(e,t)})):e.isLeaf=!0}o.listAll=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(n["a"])({url:"".concat(i),params:{more:e},method:"get"})},o.listTree=function(){return Object(n["a"])({url:"".concat(i,"/tree_view"),method:"get"})},o.create=function(e){return Object(n["a"])({url:i,data:e,method:"post"})},o.delete=function(e){return Object(n["a"])({url:"".concat(i,"/").concat(e),method:"delete"})},o.get=function(e){return Object(n["a"])({url:"".concat(i,"/").concat(e),method:"get"})},o.update=function(e,t){return Object(n["a"])({url:"".concat(i,"/").concat(e),data:t,method:"put"})},o.concreteTree=function(e){var t={key:0,title:"top",children:[]};return r(t,e),t.children},t["a"]=o},a796:function(e,t,a){"use strict";var n=a("bc3a"),i=a.n(n),o=a("9efd"),r="/api/admin/attachments",l={query:function(e){return Object(o["a"])({url:r,params:e,method:"get"})},get:function(e){return Object(o["a"])({url:"".concat(r,"/").concat(e),method:"get"})},delete:function(e){return Object(o["a"])({url:"".concat(r,"/").concat(e),method:"delete"})},deleteInBatch:function(e){return Object(o["a"])({url:"".concat(r),method:"delete",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})},update:function(e,t){return Object(o["a"])({url:"".concat(r,"/").concat(e),method:"put",data:t})},getMediaTypes:function(){return Object(o["a"])({url:"".concat(r,"/media_types"),method:"get"})},getTypes:function(){return Object(o["a"])({url:"".concat(r,"/types"),method:"get"})}};l.CancelToken=i.a.CancelToken,l.isCancel=i.a.isCancel,l.upload=function(e,t,a){return Object(o["a"])({url:"".concat(r,"/upload"),timeout:864e4,data:e,onUploadProgress:t,cancelToken:a,method:"post"})},l.uploads=function(e,t,a){return Object(o["a"])({url:"".concat(r,"/uploads"),timeout:864e4,data:e,onUploadProgress:t,cancelToken:a,method:"post"})},l.type={LOCAL:{type:"LOCAL",text:"本地"},SMMS:{type:"SMMS",text:"SM.MS"},UPOSS:{type:"UPOSS",text:"又拍云"},QINIUOSS:{type:"QINIUOSS",text:"七牛云"},ALIOSS:{type:"ALIOSS",text:"阿里云"},BAIDUBOS:{type:"BAIDUBOS",text:"百度云"},TENCENTCOS:{type:"TENCENTCOS",text:"腾讯云"},HUAWEIOBS:{type:"HUAWEIOBS",text:"华为云"}},t["a"]=l},c39e:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-tree-select",{attrs:{treeData:e.specialTreeData,placeholder:"请选择上级目录，默认为顶级目录",treeDefaultExpandAll:"",treeDataSimpleMode:!0,allowClear:!0,value:e.specialIdString},on:{change:e.handleSelectionChange}})},i=[],o=(a("6b54"),a("7f7f"),a("c5f6"),{name:"SpecialSelectTree",model:{prop:"specialId",event:"change"},props:{specialId:{type:Number,required:!0,default:0},categories:{type:Array,required:!1,default:function(){return[]}}},computed:{specialTreeData:function(){return this.categories.map((function(e){return{id:e.id,title:e.name,value:e.id.toString(),pId:e.parentId}}))},specialIdString:function(){return this.specialId.toString()}},methods:{handleSelectionChange:function(e,t,a){this.$log.debug("value: ",e),this.$log.debug("label: ",t),this.$log.debug("extra: ",a),this.$emit("change",e?parseInt(e):0)}}}),r=o,l=a("2877"),c=Object(l["a"])(r,n,i,!1,null,null,null);t["a"]=c.exports},fb32:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-row",{attrs:{gutter:12}},[a("a-col",{style:{"padding-bottom":"12px"},attrs:{xl:10,lg:10,md:10,sm:24,xs:24}},[a("a-card",{attrs:{title:e.title,bodyStyle:{padding:"16px"}}},[a("a-form",{attrs:{layout:"horizontal"}},[a("a-form-item",{attrs:{label:"名称：",help:"* 页面上所显示的名称"}},[a("a-input",{model:{value:e.specialToCreate.name,callback:function(t){e.$set(e.specialToCreate,"name",t)},expression:"specialToCreate.name"}})],1),a("a-form-item",{attrs:{label:"别名：",help:"* 一般为单个专题页面的标识，最好为英文"}},[a("a-input",{model:{value:e.specialToCreate.slug,callback:function(t){e.$set(e.specialToCreate,"slug",t)},expression:"specialToCreate.slug"}})],1),a("a-form-item",{attrs:{label:"上级目录："}},[a("special-select-tree",{attrs:{categories:e.categories},model:{value:e.specialToCreate.parentId,callback:function(t){e.$set(e.specialToCreate,"parentId",t)},expression:"specialToCreate.parentId"}})],1),a("a-form-item",{attrs:{label:"封面图：",help:"* 在专题页面可展示，需要主题支持"}},[a("a-input",{model:{value:e.specialToCreate.thumbnail,callback:function(t){e.$set(e.specialToCreate,"thumbnail",t)},expression:"specialToCreate.thumbnail"}},[a("a",{attrs:{slot:"addonAfter",href:"javascript:void(0);"},on:{click:function(t){e.thumbnailDrawerVisible=!0}},slot:"addonAfter"},[a("a-icon",{attrs:{type:"picture"}})],1)])],1),a("a-form-item",{attrs:{label:"描述：",help:"* 专题描述，部分主题可显示"}},[a("a-input",{attrs:{type:"textarea",autoSize:{minRows:3}},model:{value:e.specialToCreate.description,callback:function(t){e.$set(e.specialToCreate,"description",t)},expression:"specialToCreate.description"}})],1),a("a-form-item",["create"===e.formType?a("a-button",{attrs:{type:"primary"},on:{click:e.handleSaveClick}},[e._v("保存")]):a("a-button-group",[a("a-button",{attrs:{type:"primary"},on:{click:e.handleSaveClick}},[e._v("更新")]),"update"===e.formType?a("a-button",{attrs:{type:"dashed"},on:{click:e.handleAddSpecial}},[e._v("返回添加")]):e._e()],1)],1)],1)],1)],1),a("a-col",{style:{"padding-bottom":"1rem"},attrs:{xl:14,lg:14,md:14,sm:24,xs:24}},[a("a-card",{attrs:{title:"专题列表",bodyStyle:{padding:"16px"}}},[e.isMobile()?a("a-list",{attrs:{itemLayout:"vertical",size:"large",pagination:!1,dataSource:e.categories,loading:e.loading},scopedSlots:e._u([{key:"renderItem",fn:function(t,n){return a("a-list-item",{key:n},[a("template",{slot:"actions"},[a("span",[a("a-icon",{attrs:{type:"form"}}),e._v(" "+e._s(t.postCount)+" ")],1),a("a-dropdown",{attrs:{placement:"topLeft",trigger:["click"]}},[a("span",[a("a-icon",{attrs:{type:"bars"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.handleEditSpecial(t)}}},[e._v("编辑")])]),a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要添加【"+t.name+"】到菜单？",okText:"确定",cancelText:"取消"},on:{confirm:function(a){return e.handleSpecialToMenu(t)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("添加到菜单")])])],1),a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要删除【"+t.name+"】专题？",okText:"确定",cancelText:"取消"},on:{confirm:function(a){return e.handleDeleteSpecial(t.id)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("删除")])])],1)],1)],1)],1),a("a-list-item-meta",[a("template",{slot:"description"},[e._v(" "+e._s(t.slug)+" ")]),a("span",{staticStyle:{"max-width":"300px",display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(t.name)+" ")])],2),a("span",[e._v(" "+e._s(t.description)+" ")])],2)}}],null,!1,595326608)}):a("a-table",{attrs:{columns:e.columns,dataSource:e.categories,rowKey:function(e){return e.id},loading:e.loading,scrollToFirstRowOnChange:!0},scopedSlots:e._u([{key:"postCount",fn:function(t,n){return a("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.handleQuerySpecialPosts(n)}}},[a("a-badge",{attrs:{count:n.postCount,numberStyle:{backgroundColor:"#00e0ff"},showZero:!0,overflowCount:9999}})],1)}},{key:"action",fn:function(t,n){return a("span",{},[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.handleEditSpecial(n)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-dropdown",{attrs:{trigger:["click"]}},[a("a",{staticClass:"ant-dropdown-link",attrs:{href:"javascript:void(0);"}},[e._v("更多")]),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{key:"1"},[a("a-popconfirm",{attrs:{title:"你确定要添加【"+n.name+"】到菜单？",okText:"确定",cancelText:"取消"},on:{confirm:function(t){return e.handleSpecialToMenu(n)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("添加到菜单")])])],1),a("a-menu-item",{key:"2"},[a("a-popconfirm",{attrs:{title:"你确定要删除【"+n.name+"】专题？",okText:"确定",cancelText:"取消"},on:{confirm:function(t){return e.handleDeleteSpecial(n.id)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("删除")])])],1)],1)],1)],1)}}])})],1)],1)],1),a("AttachmentSelectDrawer",{attrs:{title:"选择封面图"},on:{listenToSelect:e.handleSelectThumbnail},model:{value:e.thumbnailDrawerVisible,callback:function(t){e.thumbnailDrawerVisible=t},expression:"thumbnailDrawerVisible"}})],1)},i=[],o=(a("7f7f"),a("ac0d")),r=a("c39e"),l=a("3993"),c=a("7e9e"),s=a("1f27"),d=[{title:"名称",ellipsis:!0,dataIndex:"name"},{title:"别名",ellipsis:!0,dataIndex:"slug"},{title:"描述",ellipsis:!0,dataIndex:"description"},{title:"文章数",dataIndex:"postCount",scopedSlots:{customRender:"postCount"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],u={components:{SpecialSelectTree:r["a"],AttachmentSelectDrawer:l["a"]},mixins:[o["a"],o["b"]],data:function(){return{formType:"create",categories:[],specialToCreate:{},thumbnailDrawerVisible:!1,menu:{},loading:!1,columns:d}},computed:{title:function(){return this.specialToCreate.id?"修改专题":"添加专题"}},created:function(){this.loadCategories()},methods:{loadCategories:function(){var e=this;this.loading=!0,c["a"].listAll(!0).then((function(t){e.categories=t.data.data,e.loading=!1}))},handleSaveClick:function(){this.createOrUpdateSpecial()},handleAddSpecial:function(){this.formType="create",this.specialToCreate={}},handleEditSpecial:function(e){this.specialToCreate=e,this.formType="update"},handleDeleteSpecial:function(e){var t=this;c["a"].delete(e).then((function(e){t.$message.success("删除成功！"),t.loadCategories(),t.handleAddSpecial()}))},createOrUpdateSpecial:function(){var e=this;this.specialToCreate.name?(this.specialToCreate.id?c["a"].update(this.specialToCreate.id,this.specialToCreate).then((function(t){e.$message.success("更新成功！"),e.loadCategories()})):c["a"].create(this.specialToCreate).then((function(t){e.$message.success("保存成功！"),e.loadCategories()})),this.handleAddSpecial()):this.$notification["error"]({message:"提示",description:"专题名称不能为空！"})},handleSpecialToMenu:function(e){var t=this;this.menu["name"]=e.name,this.menu["url"]="".concat(e.fullPath),s["a"].create(this.menu).then((function(e){t.$message.success("添加到菜单成功！"),t.menu={}}))},handleSelectThumbnail:function(e){this.$set(this.specialToCreate,"thumbnail",encodeURI(e.path)),this.thumbnailDrawerVisible=!1},handleQuerySpecialPosts:function(e){this.$router.push({name:"PostList",query:{specialId:e.id}})}}},p=u,h=a("2877"),m=Object(h["a"])(p,n,i,!1,null,null,null);t["default"]=m.exports}}]);